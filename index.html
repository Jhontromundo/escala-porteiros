<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Porteiros - CCB Santa Am√©lia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #1976d2;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .controls input, .controls button {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .controls input:focus {
            outline: none;
            border-color: #1976d2;
        }
        
        .btn-gerar {
            background: #1976d2;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-gerar:hover {
            background: #1565c0;
        }
        
        .btn-pdf {
            background: #d32f2f;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-pdf:hover {
            background: #c62828;
        }
        
        .btn-gerenciar {
            background: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-gerenciar:hover {
            background: #45a049;
        }
        
        .tabela-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f5f5f5;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr:hover {
            background: #e3f2fd;
        }
        
        .servico-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }
        
        .oficial { background: #e3f2fd; color: #1976d2; }
        .rjm { background: #e8f5e8; color: #388e3c; }
        .rsetor { background: #fff3e0; color: #f57c00; }
        .rlocal { background: #f3e5f5; color: #7b1fa2; }
        .ensaio { background: #e8eaf6; color: #3f51b5; }
        
        .mesclar {
            text-align: center;
            background: #f0f0f0;
        }
        
        .editavel {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            min-height: 20px;
            display: inline-block;
            min-width: 60px;
        }
        
        .editavel:hover {
            background-color: #e3f2fd;
            border: 1px dashed #1976d2;
        }
        
        .editando {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
        }
        
        .destaque {
            background-color: #ffeb3b !important;
            font-weight: bold;
            color: #f57f17;
        }
        
        .dropdown-edicao {
            background: white;
            border: 2px solid #1976d2;
            border-radius: 4px;
            padding: 4px;
            font-size: 12px;
            min-width: 120px;
        }
        
        .btn-edicao {
            background: #4caf50;
            color: white;
            border: none;
            padding: 2px 6px;
            margin: 0 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .btn-cancelar {
            background: #f44336;
        }
        
        .conflito-alerta {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }
        
        .conflito-alerta h3 {
            color: #d32f2f;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .conflito-lista {
            color: #d32f2f;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -10px;
        }
        
        .close:hover {
            color: #000;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: #f5f5f5;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .tab.active {
            background: #1976d2;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #e3f2fd;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grupo-editor {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .grupo-titulo {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .membros-lista {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .membro-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .membro-nome {
            flex: 1;
            font-weight: bold;
        }
        
        .btn-mover, .btn-remover {
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-mover {
            background: #2196f3;
        }
        
        .btn-adicionar-membro {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        
        .select-membro {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            flex: 1;
        }
        
        .btn-add {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .btn-modal {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .btn-salvar {
            background: #4caf50;
            color: white;
        }
        
        .btn-salvar:hover {
            background: #45a049;
        }
        
        .btn-restaurar {
            background: #ff9800;
            color: white;
        }
        
        .btn-restaurar:hover {
            background: #f57c00;
        }
        
        .btn-cancelar-modal {
            background: #f44336;
            color: white;
        }
        
        .btn-cancelar-modal:hover {
            background: #d32f2f;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls input, .controls button {
                width: 100%;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Gerador de Escalas de Servi√ßo</h1>
            <p>Congrega√ß√£o Crist√£ no Brasil - Santa Am√©lia - Curitiba PR</p>
        </div>
        
        <div class="controls">
            <label for="mesAno">üìÖ Selecionar M√™s:</label>
            <input type="month" id="mesAno" onchange="gerarEscala()">
            <button class="btn-gerar" onclick="gerarEscala()">üîÑ Gerar Escala</button>
            <button class="btn-pdf" onclick="gerarPDF()">üìÑ Gerar PDF</button>
            <button class="btn-gerenciar" onclick="abrirGerenciador()">‚öôÔ∏è Gerenciar Grupos</button>
            <div id="membroDestacado" style="display: none;" class="btn-gerar">
                Destacando: <span id="nomeDestacado"></span>
                <button onclick="limparDestaque()" style="background: transparent; border: none; color: white; margin-left: 10px;">‚úï</button>
            </div>
        </div>
        
        <div id="alertaConflitos" class="conflito-alerta">
            <h3>‚ö†Ô∏è Conflitos de Mesmo Dia Detectados</h3>
            <div id="listaConflitos" class="conflito-lista"></div>
            <p style="font-size: 12px; margin-top: 10px; color: #666;">
                <strong>Dica:</strong> Clique duplo em qualquer nome para editar manualmente
            </p>
        </div>
        
        <div class="tabela-container">
            <table id="tabelaEscala">
                <thead>
                    <tr>
                        <th>Dia</th>
                        <th>Dia da Semana</th>
                        <th>Servi√ßo</th>
                        <th>Ped Ora√ß√£o</th>
                        <th>Principal</th>
                        <th>Lateral</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    <!-- Dados ser√£o inseridos aqui -->
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <p>‚úÖ Sistema de Escalas Implementado</p>
            <p>üéØ Distribui√ß√£o Justa e Inteligente</p>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Grupos -->
    <div id="modalGerenciador" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharGerenciador()">&times;</span>
            <h2 style="text-align: center; color: #1976d2; margin-bottom: 30px;">‚öôÔ∏è Gerenciar Grupos e Sequ√™ncias</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="mostrarTab('grupos')">üë• Grupos Semanais</button>
                <button class="tab" onclick="mostrarTab('sequencias')">üîÑ Sequ√™ncias Especiais</button>
            </div>
            
            <!-- Tab Grupos Semanais -->
            <div id="tab-grupos" class="tab-content active">
                <div class="grupo-editor">
                    <div class="grupo-titulo">üóìÔ∏è 3¬™ Feira (4 pessoas - 1 folga rotativa)</div>
                    <div id="grupo-terca" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-terca" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('terca')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üóìÔ∏è 5¬™ Feira (3 pessoas - sem folga)</div>
                    <div id="grupo-quinta" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-quinta" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('quinta')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üóìÔ∏è S√°bado (4 pessoas - 1 folga rotativa)</div>
                    <div id="grupo-sabado" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-sabado" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('sabado')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üóìÔ∏è Domingo Oficial (4 pessoas - 1 folga rotativa)</div>
                    <div id="grupo-domingoOficial" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-domingoOficial" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('domingoOficial')">+ Adicionar</button>
                    </div>
                </div>
            </div>
            
            <!-- Tab Sequ√™ncias Especiais -->
            <div id="tab-sequencias" class="tab-content">
                <div class="grupo-editor">
                    <div class="grupo-titulo">üìø RJM (2 por domingo)</div>
                    <div id="sequencia-rjm" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-rjm" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('rjm')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üè¢ R. SETOR (1 por m√™s)</div>
                    <div id="sequencia-rSetor" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-rSetor" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('rSetor')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üåç R. LOCAL (trimestral)</div>
                    <div id="sequencia-rLocal" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-rLocal" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('rLocal')">+ Adicionar</button>
                    </div>
                </div>
                
                <div class="grupo-editor">
                    <div class="grupo-titulo">üéµ ENSAIO (2 por m√™s)</div>
                    <div id="sequencia-ensaio" class="membros-lista"></div>
                    <div class="btn-adicionar-membro">
                        <select id="select-ensaio" class="select-membro"></select>
                        <button class="btn-add" onclick="adicionarMembro('ensaio')">+ Adicionar</button>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-modal btn-salvar" onclick="salvarAlteracoes()">üíæ Salvar e Regenerar</button>
                <button class="btn-modal btn-restaurar" onclick="restaurarPadrao()">üîÑ Restaurar Padr√£o</button>
                <button class="btn-modal btn-cancelar-modal" onclick="fecharGerenciador()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Grupos por dia da semana (configura√ß√£o padr√£o)
        const gruposPadraoOriginal = {
            terca: ['AFONSO', 'ALGACIR', 'JONAS', 'ZANIN'],
            quinta: ['EDI', 'MARCOS', 'SAULO'],
            sabado: ['JOS√â CARLOS', 'RODINEI', 'VANDERLEI', 'ELIZEU'],
            domingoOficial: ['JOS√â CARDOSO', 'ODEMIR', 'SAMUEL', 'EDIVAN']
        };

        // Sequ√™ncias dos servi√ßos especiais (configura√ß√£o padr√£o)
        const sequenciasPadraoOriginal = {
            rjm: ['MARCOS', 'JOS√â CARDOSO', 'EDI', 'EDIVAN', 'JOS√â CARLOS', 'VANDERLEI', 'ELIZEU', 'ZANIN', 'ALGACIR', 'SAULO', 'RODINEI', 'SAMUEL', 'C√âLIO', 'JONAS', 'AFONSO'],
            rSetor: ['ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'RODINEI', 'ALGACIR', 'VANDERLEI', 'JONAS', 'C√âLIO', 'EDI', 'SAMUEL', 'JOS√â CARLOS', 'MARCOS', 'EDIVAN', 'SAULO'],
            rLocal: ['EDI', 'SAMUEL', 'EDIVAN', 'JONAS', 'JOS√â CARLOS', 'ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'RODINEI', 'ALGACIR', 'VANDERLEI', 'C√âLIO', 'SAULO', 'MARCOS'],
            ensaio: ['RODINEI', 'ALGACIR', 'VANDERLEI', 'SAULO', 'C√âLIO', 'EDI', 'SAMUEL', 'EDIVAN', 'MARCOS', 'JOS√â CARLOS', 'ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'JONAS']
        };

        // Grupos e sequ√™ncias atuais (carregados do localStorage ou padr√£o)
        let gruposPorDia = carregarConfiguracoes('grupos') || JSON.parse(JSON.stringify(gruposPadraoOriginal));
        let sequencias = carregarConfiguracoes('sequencias') || JSON.parse(JSON.stringify(sequenciasPadraoOriginal));

        const diasSemana = ['DOMINGO', '2¬™ FEIRA', '3¬™ FEIRA', '4¬™ FEIRA', '5¬™ FEIRA', '6¬™ FEIRA', 'S√ÅBADO'];
        let escalaAtual = [];
        let membroDestacadoAtual = null;
        let editandoAtualmente = null;

        // Lista de todos os membros para edi√ß√£o
        const todosMembros = [
            'AFONSO', 'ALGACIR', 'JONAS', 'ZANIN', 'EDI', 'MARCOS', 'SAULO',
            'JOS√â CARLOS', 'RODINEI', 'VANDERLEI', 'ELIZEU', 'JOS√â CARDOSO',
            'ODEMIR', 'SAMUEL', 'EDIVAN', 'C√âLIO'
        ];

        // Fun√ß√µes de persist√™ncia
        function salvarConfiguracoes(tipo, dados) {
            try {
                localStorage.setItem('escalas_' + tipo, JSON.stringify(dados));
            } catch (e) {
                console.log('N√£o foi poss√≠vel salvar no localStorage');
            }
        }

        function carregarConfiguracoes(tipo) {
            try {
                const dados = localStorage.getItem('escalas_' + tipo);
                return dados ? JSON.parse(dados) : null;
            } catch (e) {
                console.log('N√£o foi poss√≠vel carregar do localStorage');
                return null;
            }
        }

        // Fun√ß√µes do gerenciador de grupos
        function abrirGerenciador() {
            const modal = document.getElementById('modalGerenciador');
            modal.style.display = 'block';
            atualizarInterfaceGerenciador();
        }

        function fecharGerenciador() {
            const modal = document.getElementById('modalGerenciador');
            modal.style.display = 'none';
        }

        function mostrarTab(tabNome) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar tab selecionada
            document.getElementById('tab-' + tabNome).classList.add('active');
            event.target.classList.add('active');
        }

        function atualizarInterfaceGerenciador() {
            // Atualizar grupos semanais
            const gruposSemanais = ['terca', 'quinta', 'sabado', 'domingoOficial'];
            gruposSemanais.forEach(grupo => {
                atualizarListaMembros(grupo, gruposPorDia[grupo], 'grupo');
                atualizarSelectMembros(grupo);
            });

            // Atualizar sequ√™ncias especiais
            const sequenciasEspeciais = ['rjm', 'rSetor', 'rLocal', 'ensaio'];
            sequenciasEspeciais.forEach(seq => {
                atualizarListaMembros(seq, sequencias[seq], 'sequencia');
                atualizarSelectMembros(seq);
            });
        }

        function atualizarListaMembros(nomeGrupo, membros, tipo) {
            const container = document.getElementById((tipo === 'grupo' ? 'grupo-' : 'sequencia-') + nomeGrupo);
            container.innerHTML = '';

            membros.forEach((membro, index) => {
                const item = document.createElement('div');
                item.className = 'membro-item';
                item.innerHTML = `
                    <span class="membro-nome">${membro}</span>
                    <button class="btn-mover" onclick="moverMembro('${nomeGrupo}', ${index}, -1, '${tipo}')">‚Üë</button>
                    <button class="btn-mover" onclick="moverMembro('${nomeGrupo}', ${index}, 1, '${tipo}')">‚Üì</button>
                    <button class="btn-remover" onclick="removerMembro('${nomeGrupo}', ${index}, '${tipo}')">üóëÔ∏è</button>
                `;
                container.appendChild(item);
            });
        }

        function atualizarSelectMembros(nomeGrupo) {
            const select = document.getElementById('select-' + nomeGrupo);
            select.innerHTML = '<option value="">Selecione um membro...</option>';

            todosMembros.forEach(membro => {
                const option = document.createElement('option');
                option.value = membro;
                option.textContent = membro;
                select.appendChild(option);
            });
        }

        function adicionarMembro(nomeGrupo) {
            const select = document.getElementById('select-' + nomeGrupo);
            const novoMembro = select.value;

            if (!novoMembro) {
                alert('Selecione um membro primeiro!');
                return;
            }

            // Verificar se √© grupo ou sequ√™ncia
            let isGrupo = ['terca', 'quinta', 'sabado', 'domingoOficial'].includes(nomeGrupo);
            let lista = isGrupo ? gruposPorDia[nomeGrupo] : sequencias[nomeGrupo];

            if (lista.includes(novoMembro)) {
                alert('Este membro j√° est√° neste grupo/sequ√™ncia!');
                return;
            }

            lista.push(novoMembro);
            atualizarListaMembros(nomeGrupo, lista, isGrupo ? 'grupo' : 'sequencia');
            select.value = '';
        }

        function removerMembro(nomeGrupo, index, tipo) {
            if (!confirm('Tem certeza que deseja remover este membro?')) return;

            let lista = tipo === 'grupo' ? gruposPorDia[nomeGrupo] : sequencias[nomeGrupo];
            lista.splice(index, 1);
            atualizarListaMembros(nomeGrupo, lista, tipo);
        }

        function moverMembro(nomeGrupo, index, direcao, tipo) {
            let lista = tipo === 'grupo' ? gruposPorDia[nomeGrupo] : sequencias[nomeGrupo];
            const novoIndex = index + direcao;

            if (novoIndex < 0 || novoIndex >= lista.length) return;

            // Trocar posi√ß√µes
            [lista[index], lista[novoIndex]] = [lista[novoIndex], lista[index]];
            atualizarListaMembros(nomeGrupo, lista, tipo);
        }

        function salvarAlteracoes() {
            if (!confirm('Salvar altera√ß√µes e regenerar escala?')) return;

            // Salvar no localStorage
            salvarConfiguracoes('grupos', gruposPorDia);
            salvarConfiguracoes('sequencias', sequencias);

            // Fechar modal
            fecharGerenciador();

            // Regenerar escala
            gerarEscala();

            alert('‚úÖ Altera√ß√µes salvas com sucesso!');
        }

        function restaurarPadrao() {
            if (!confirm('Restaurar configura√ß√µes padr√£o? Todas as altera√ß√µes ser√£o perdidas!')) return;

            // Restaurar grupos padr√£o
            gruposPorDia = JSON.parse(JSON.stringify(gruposPadraoOriginal));
