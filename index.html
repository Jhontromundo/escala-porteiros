<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Porteiros - CCB Santa Am√©lia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #1976d2;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .controls input, .controls button {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .controls input:focus {
            outline: none;
            border-color: #1976d2;
        }
        
        .btn-gerar {
            background: #1976d2;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-gerar:hover {
            background: #1565c0;
        }
        
        .btn-pdf {
            background: #d32f2f;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-pdf:hover {
            background: #c62828;
        }
        
        .tabela-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f5f5f5;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr:hover {
            background: #e3f2fd;
        }
        
        .servico-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }
        
        .oficial { background: #e3f2fd; color: #1976d2; }
        .rjm { background: #e8f5e8; color: #388e3c; }
        .rsetor { background: #fff3e0; color: #f57c00; }
        .rlocal { background: #f3e5f5; color: #7b1fa2; }
        .ensaio { background: #e8eaf6; color: #3f51b5; }
        
        .mesclar {
            text-align: center;
            font-weight: bold;
            background: #f0f0f0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls input, .controls button {
                width: 100%;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Gerador de Escalas de Servi√ßo</h1>
            <p>Congrega√ß√£o Crist√£ no Brasil - Santa Am√©lia - Curitiba PR</p>
        </div>
        
        <div class="controls">
            <label for="mesAno">üìÖ Selecionar M√™s:</label>
            <input type="month" id="mesAno" onchange="gerarEscala()">
            <button class="btn-gerar" onclick="gerarEscala()">üîÑ Gerar Escala</button>
            <button class="btn-pdf" onclick="gerarPDF()">üìÑ Gerar PDF</button>
        </div>
        
        <div class="tabela-container">
            <table id="tabelaEscala">
                <thead>
                    <tr>
                        <th>Dia</th>
                        <th>Dia da Semana</th>
                        <th>Servi√ßo</th>
                        <th>Ped Ora√ß√£o</th>
                        <th>Principal</th>
                        <th>Lateral</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    <!-- Dados ser√£o inseridos aqui -->
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <p>‚úÖ Sistema de Escalas Implementado</p>
            <p>üéØ Distribui√ß√£o Justa e Inteligente</p>
        </div>
    </div>

    <script>
        // Grupos por dia da semana
        const gruposPorDia = {
            terca: ['AFONSO', 'ALGACIR', 'JONAS', 'ZANIN'],
            quinta: ['EDI', 'MARCOS', 'SAULO'],
            sabado: ['JOS√â CARLOS', 'RODINEI', 'VANDERLEI', 'ELIZEU'],
            domingoOficial: ['JOS√â CARDOSO', 'ODEMIR', 'SAMUEL', 'EDIVAN']
        };

        // Sequ√™ncias dos servi√ßos especiais
        const sequencias = {
            rjm: ['MARCOS', 'JOS√â CARDOSO', 'EDI', 'EDIVAN', 'JOS√â CARLOS', 'VANDERLEI', 'ELIZEU', 'ZANIN', 'ALGACIR', 'SAULO', 'RODINEI', 'SAMUEL', 'C√âLIO', 'JONAS', 'AFONSO'],
            rSetor: ['ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'RODINEI', 'ALGACIR', 'VANDERLEI', 'JONAS', 'C√âLIO', 'EDI', 'SAMUEL', 'JOS√â CARLOS', 'MARCOS', 'EDIVAN', 'SAULO'],
            rLocal: ['EDI', 'SAMUEL', 'EDIVAN', 'JONAS', 'JOS√â CARLOS', 'ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'RODINEI', 'ALGACIR', 'VANDERLEI', 'C√âLIO', 'SAULO', 'MARCOS'],
            ensaio: ['RODINEI', 'ALGACIR', 'VANDERLEI', 'SAULO', 'C√âLIO', 'EDI', 'SAMUEL', 'EDIVAN', 'MARCOS', 'JOS√â CARLOS', 'ELIZEU', 'ZANIN', 'JOS√â CARDOSO', 'AFONSO', 'JONAS']
        };

        const diasSemana = ['DOMINGO', '2¬™ FEIRA', '3¬™ FEIRA', '4¬™ FEIRA', '5¬™ FEIRA', '6¬™ FEIRA', 'S√ÅBADO'];

        // Inicializar com m√™s atual
        window.onload = function() {
            const hoje = new Date();
            const mesAtual = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
            document.getElementById('mesAno').value = mesAtual;
            gerarEscala();
        };

        function getDiasNoMes(ano, mes) {
            return new Date(ano, mes, 0).getDate();
        }

        function getDiaSemana(ano, mes, dia) {
            return new Date(ano, mes - 1, dia).getDay();
        }

        function encontrarNesimoDay(ano, mes, diaSemana, nesimo) {
            let contador = 0;
            const diasNoMes = getDiasNoMes(ano, mes);
            
            for (let dia = 1; dia <= diasNoMes; dia++) {
                if (getDiaSemana(ano, mes, dia) === diaSemana) {
                    contador++;
                    if (contador === nesimo) {
                        return dia;
                    }
                }
            }
            return null;
        }

        function temRLocal(mes) {
            return [1, 4, 7, 10].includes(mes);
        }

        function distribuirGrupoComFolga(grupo, totalOcorrencias, indiceInicial = 0) {
            const escalacao = [];
            let indiceAtual = indiceInicial;
            
            for (let i = 0; i < totalOcorrencias; i++) {
                const posicoes = [];
                const indiceFolga = (indiceAtual + 3) % grupo.length;
                
                for (let j = 0; j < 3; j++) {
                    const indiceAtualPessoa = (indiceAtual + j) % grupo.length;
                    if (indiceAtualPessoa !== indiceFolga) {
                        posicoes.push(grupo[indiceAtualPessoa]);
                    }
                }
                
                while (posicoes.length < 3) {
                    for (let k = 0; k < grupo.length; k++) {
                        const indiceK = (indiceAtual + k) % grupo.length;
                        if (indiceK !== indiceFolga && !posicoes.includes(grupo[indiceK])) {
                            posicoes.push(grupo[indiceK]);
                            break;
                        }
                    }
                }
                
                escalacao.push({
                    pedOracao: posicoes[0],
                    principal: posicoes[1],
                    lateral: posicoes[2]
                });
                
                indiceAtual = indiceFolga;
            }
            
            return escalacao;
        }

        function distribuirGrupoSemFolga(grupo, totalOcorrencias, indiceInicial = 0) {
            const escalacao = [];
            
            for (let i = 0; i < totalOcorrencias; i++) {
                const posicaoBase = (indiceInicial + i) % grupo.length;
                
                escalacao.push({
                    pedOracao: grupo[posicaoBase],
                    principal: grupo[(posicaoBase + 1) % grupo.length],
                    lateral: grupo[(posicaoBase + 2) % grupo.length]
                });
            }
            
            return escalacao;
        }

        function gerarEscala() {
            const mesAnoValue = document.getElementById('mesAno').value;
            if (!mesAnoValue) return;

            const [ano, mes] = mesAnoValue.split('-').map(Number);
            const diasNoMes = getDiasNoMes(ano, mes);
            const escala = [];
            
            // Contar ocorr√™ncias
            const contadores = { terca: 0, quinta: 0, sabado: 0, domingo: 0 };
            const diasPorTipo = { terca: [], quinta: [], sabado: [], domingo: [] };
            
            for (let dia = 1; dia <= diasNoMes; dia++) {
                const diaSemana = getDiaSemana(ano, mes, dia);
                
                if (diaSemana === 2) {
                    contadores.terca++;
                    diasPorTipo.terca.push(dia);
                } else if (diaSemana === 4) {
                    contadores.quinta++;
                    diasPorTipo.quinta.push(dia);
                } else if (diaSemana === 6) {
                    contadores.sabado++;
                    diasPorTipo.sabado.push(dia);
                } else if (diaSemana === 0) {
                    contadores.domingo++;
                    diasPorTipo.domingo.push(dia);
                }
            }

            // Gerar escala√ß√µes
            const escalacaoTerca = distribuirGrupoComFolga(gruposPorDia.terca, contadores.terca);
            const escalacaoQuinta = distribuirGrupoSemFolga(gruposPorDia.quinta, contadores.quinta);
            const escalacaoSabado = distribuirGrupoComFolga(gruposPorDia.sabado, contadores.sabado);
            const escalacaoDomingo = distribuirGrupoComFolga(gruposPorDia.domingoOficial, contadores.domingo);

            // Sequ√™ncias especiais
            let indiceRJM = 0;
            let indiceRSetor = 0;
            let indiceRLocal = 0;
            let indiceEnsaio = 0;

            // 3¬™ feiras
            diasPorTipo.terca.forEach((dia, index) => {
                const escalacaoDia = escalacaoTerca[index];
                escala.push({
                    dia,
                    diaSemana: '3¬™ FEIRA',
                    servico: 'OFICIAL',
                    pedOracao: escalacaoDia.pedOracao,
                    principal: escalacaoDia.principal,
                    lateral: escalacaoDia.lateral,
                    classe: 'oficial'
                });
            });

            // 5¬™ feiras
            diasPorTipo.quinta.forEach((dia, index) => {
                const escalacaoDia = escalacaoQuinta[index];
                escala.push({
                    dia,
                    diaSemana: '5¬™ FEIRA',
                    servico: 'OFICIAL',
                    pedOracao: escalacaoDia.pedOracao,
                    principal: escalacaoDia.principal,
                    lateral: escalacaoDia.lateral,
                    classe: 'oficial'
                });
            });

            // S√°bados
            diasPorTipo.sabado.forEach((dia, index) => {
                const escalacaoDia = escalacaoSabado[index];
                escala.push({
                    dia,
                    diaSemana: 'S√ÅBADO',
                    servico: 'OFICIAL',
                    pedOracao: escalacaoDia.pedOracao,
                    principal: escalacaoDia.principal,
                    lateral: escalacaoDia.lateral,
                    classe: 'oficial'
                });
            });

            // Domingos
            diasPorTipo.domingo.forEach((dia, index) => {
                // RJM primeiro
                const membroRJM1 = sequencias.rjm[indiceRJM % sequencias.rjm.length];
                const membroRJM2 = sequencias.rjm[(indiceRJM + 1) % sequencias.rjm.length];
                indiceRJM += 2;

                escala.push({
                    dia,
                    diaSemana: 'DOMINGO',
                    servico: 'RJM',
                    pedOracao: membroRJM1,
                    principal: '-',
                    lateral: membroRJM2,
                    classe: 'rjm'
                });

                // OFICIAL depois
                const escalacaoDia = escalacaoDomingo[index];
                escala.push({
                    dia,
                    diaSemana: 'DOMINGO',
                    servico: 'OFICIAL',
                    pedOracao: escalacaoDia.pedOracao,
                    principal: escalacaoDia.principal,
                    lateral: escalacaoDia.lateral,
                    classe: 'oficial'
                });
            });

            // R. SETOR
            const terceiraSegunda = encontrarNesimoDay(ano, mes, 1, 3);
            if (terceiraSegunda) {
                escala.push({
                    dia: terceiraSegunda,
                    diaSemana: '2¬™ FEIRA',
                    servico: 'R. SETOR',
                    pedOracao: sequencias.rSetor[indiceRSetor % sequencias.rSetor.length],
                    principal: 'MESCLAR',
                    lateral: 'MESCLAR',
                    classe: 'rsetor',
                    mesclar: true
                });
                indiceRSetor++;
            }

            // R. LOCAL
            if (temRLocal(mes)) {
                const quartaSegunda = encontrarNesimoDay(ano, mes, 1, 4);
                if (quartaSegunda) {
                    escala.push({
                        dia: quartaSegunda,
                        diaSemana: '2¬™ FEIRA',
                        servico: 'R. LOCAL',
                        pedOracao: sequencias.rLocal[indiceRLocal % sequencias.rLocal.length],
                        principal: 'MESCLAR',
                        lateral: 'MESCLAR',
                        classe: 'rlocal',
                        mesclar: true
                    });
                    indiceRLocal++;
                }
            }

            // ENSAIO
            const quartaSexta = encontrarNesimoDay(ano, mes, 5, 4);
            if (quartaSexta) {
                const membroEnsaio1 = sequencias.ensaio[indiceEnsaio % sequencias.ensaio.length];
                const membroEnsaio2 = sequencias.ensaio[(indiceEnsaio + 1) % sequencias.ensaio.length];
                
                escala.push({
                    dia: quartaSexta,
                    diaSemana: '6¬™ FEIRA',
                    servico: 'ENSAIO',
                    pedOracao: membroEnsaio1,
                    principal: '-',
                    lateral: membroEnsaio2,
                    classe: 'ensaio'
                });
                indiceEnsaio += 2;
            }

            // Ordenar e exibir
            escala.sort((a, b) => a.dia - b.dia);
            exibirEscala(escala);
        }

        function exibirEscala(escala) {
            const tbody = document.getElementById('corpoTabela');
            tbody.innerHTML = '';

            escala.forEach(item => {
                const row = document.createElement('tr');
                
                if (item.mesclar) {
                    row.innerHTML = `
                        <td>${item.dia}</td>
                        <td>${item.diaSemana}</td>
                        <td><span class="servico-badge ${item.classe}">${item.servico}</span></td>
                        <td colspan="3" class="mesclar">${item.pedOracao}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${item.dia}</td>
                        <td>${item.diaSemana}</td>
                        <td><span class="servico-badge ${item.classe}">${item.servico}</span></td>
                        <td>${item.pedOracao}</td>
                        <td>${item.principal}</td>
                        <td>${item.lateral}</td>
                    `;
                }
                
                tbody.appendChild(row);
            });
        }

        function gerarPDF() {
            const mesAnoValue = document.getElementById('mesAno').value;
            if (!mesAnoValue) {
                alert('Selecione um m√™s primeiro!');
                return;
            }

            const [ano, mes] = mesAnoValue.split('-');
            const meses = [
                'JANEIRO', 'FEVEREIRO', 'MAR√áO', 'ABRIL', 'MAIO', 'JUNHO',
                'JULHO', 'AGOSTO', 'SETEMBRO', 'OUTUBRO', 'NOVEMBRO', 'DEZEMBRO'
            ];
            const mesNome = meses[parseInt(mes) - 1];
            
            const tabela = document.getElementById('tabelaEscala');
            const linhas = Array.from(tabela.querySelectorAll('tbody tr'));
            
            let linhasHTML = '';
            linhas.forEach(linha => {
                const colunas = Array.from(linha.children);
                if (colunas.length === 4) { // Linha mesclada
                    linhasHTML += `
                        <tr>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[0].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[1].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[2].textContent}</td>
                            <td colspan="3" style="border: 1px solid #333; padding: 8px; text-align: center; background-color: #f5f5f5; font-weight: bold;">${colunas[3].textContent}</td>
                        </tr>
                    `;
                } else {
                    linhasHTML += `
                        <tr>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[0].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[1].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[2].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[3].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[4].textContent}</td>
                            <td style="border: 1px solid #333; padding: 8px; text-align: center;">${colunas[5].textContent}</td>
                        </tr>
                    `;
                }
            });
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Escala de Porteiros - ${mesNome} ${ano}</title>
                    <style>
                        @page { margin: 2cm; size: A4; }
                        body { font-family: Arial, sans-serif; margin: 0; padding: 0; color: #333; }
                        .cabecalho { text-align: center; margin-bottom: 30px; }
                        .cabecalho h1 { font-size: 16px; font-weight: bold; margin: 5px 0; }
                        .cabecalho h2 { font-size: 14px; font-weight: bold; margin: 5px 0; }
                        .cabecalho h3 { font-size: 14px; font-weight: bold; margin: 5px 0; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
                        th { background-color: #f0f0f0; font-weight: bold; text-align: center; padding: 10px 8px; border: 1px solid #333; }
                        td { text-align: center; padding: 8px; border: 1px solid #333; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                    </style>
                </head>
                <body>
                    <div class="cabecalho">
                        <h1>CONGREGA√á√ÉO CRIST√É NO BRASIL ‚Äì SANTA AM√âLIA ‚Äì CURITIBA PR</h1>
                        <h2>ESCALA DE PORTEIROS</h2>
                        <h3>${mesNome} DE ${ano}</h3>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>DIA</th>
                                <th>DIA DA SEMANA</th>
                                <th>SERVI√áO</th>
                                <th>PED ORA√á√ÉO</th>
                                <th>PRINCIPAL</th>
                                <th>LATERAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${linhasHTML}
                        </tbody>
                    </table>
                    
                    <script>
                        window.onload = function() {
                            window.print();
                        }
                    </script>
                </body>
                </html>
            `;
            
            const novaJanela = window.open('', '_blank');
            novaJanela.document.write(htmlContent);
            novaJanela.document.close();
        }
    </script>
</body>
</html>
